{% extends 'layout.html' %}

{% block ourpage %}

<!-- --------------------------------------------------------------Carousels(iamges revoling at the front page)------------------------------------------- -->
<div id="carouselExampleCaptions" class="carousel slide" data-ride="carousel">
    <ol class="carousel-indicators">
        <li data-target="#carouselExampleCaptions" data-slide-to="0" class="active"></li>
        <li data-target="#carouselExampleCaptions" data-slide-to="1"></li>
        <li data-target="#carouselExampleCaptions" data-slide-to="2"></li>
    </ol>
    <div class="carousel-inner">
        <div class="carousel-item active">
            <img src="/static/images/official_carousel1.jpg" class="d-block w-100" alt="...">
            <div class="carousel-caption d-none d-md-block">

            </div>
        </div>
        <div class="carousel-item">
            <img src="/static/images/official_carousel2.jpg" class="d-block w-100" alt="...">
            <div class="carousel-caption d-none d-md-block">

            </div>
        </div>
        <div class="carousel-item">
            <img src="/static/images/official_carousel3.jpg" class="d-block w-100" alt="...">
            <div class="carousel-caption d-none d-md-block">

            </div>
        </div>
    </div>
    <a class="carousel-control-prev" href="#carouselExampleCaptions" role="button" data-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="sr-only">Previous</span>
    </a>
    <a class="carousel-control-next" href="#carouselExampleCaptions" role="button" data-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="sr-only">Next</span>
    </a>
</div>

<!-- ------------------------------------------------------Carousel Window-------------------------------------------------------------------------- -->




<br>
<br>

<!-- division of taking file as an input -->

<div id="input-form-page">
    <p align="center"><a href="{{ url_for('import_from_email') }}" ><button class="btn btn-warning" style="height:75px;width:150px">Import from Email</button></a></p>
    <form class="form-group" action="/display" method="post" enctype="multipart/form-data">


        <div class="container" id="upload-file">
            <div class="">
                <div class="container" id="container-input-file" style="margin-left:-120px">
                    

                    <!-- File input in form of pdf and image -->
                    <input type="file" name="file" accept="application/pdf,image/jpeg" id="file" class="inputfile"
                        style=" margin-left:220px; background-color: black; color: white; " />

                    <br>
                    <br>
                    <br>
                    <div class="select" style="margin-left:480px;">
                        <select id="language" name="language" style="flex: 1; padding: 0 .5em; color: #fff; cursor: pointer;" >
                            <option value="en">English</option>
                            <option value="de">German</option>
                            <option value="fr">French</option>
                            <option value="es">Spanish</option>
                            <option value="pt">Portuguese</option>
                            <option value="it">Italian</option>
                            <option value="nl">Dutch</option>
                            <option value="pl">Polish</option>
                            <option value="dk">Danish</option>

                        </select>
                    </div>
                    

                    <br>
                    <br>

                    <div id="pdf_count" class="alert alert-warning" role="alert"
                        style="margin-left: 280px; display: none;">



                    </div>
                    <!-- printing the page size and page count -->
                    <p id="size"></p>
                    <p id="size_val" style="color: red;"></p>


                    <div id="loading" style="display:none; margin-left:250px">
                        <img src="/static/loadingimage.gif">

                    </div>


                    <!-- Group of Errors if the user input is not proper -->

                    <div id="pagetype" class="alert alert-danger alert-dismissible fade show" role="alert"
                        style="display:none; margin-left: 280px;">
                        <p>Please select display type!!</p>
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>

                    <div id="pagetype1" class="alert alert-danger alert-dismissible fade show" role="alert"
                        style="display:none; margin-left: 280px;">
                        <p>Please enter page numbers!!</p>
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div id="pagetype2" class="alert alert-danger alert-dismissible fade show" role="alert"
                        style="display:none; margin-left: 280px;">
                        <p>Please Check the order of the page number. Start Page should not be greater than end Page!!
                        </p>
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div id="pagetype3" class="alert alert-danger alert-dismissible fade show" role="alert"
                        style="display:none; margin-left: 280px;">
                        <p>The Page Number you are looking for does not exist. Please insert a correct page number!!</p>
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>



                </div>

                <br>
                <br>


                <!-- Divison for selecting page type -->
                <div class="container" id="select-page-type" style="margin-left:150px;">


                    <p style="margin-left:100px;">
                        One Click away from extraction, Please select any one option!!!
                    </p>

                    <!-- All the cards group where the option is given for selecting the type of pages  -->
                    <div class="card-group center">

                        <!-- Card for Selecting Single Page Number -->
                        <div class="col-xl-3 col-sm-6 col-12">
                            <div class="card" style="max-width: 18rem;">
                                <div class="card-content">

                                    <div class="card-body">

                                        <div class="media d-flex">
                                            <div class="media-body text-left">


                                                <div>
                                                    <input type="radio" name="options" value='1' id="choice-single-page"
                                                        required>
                                                    <label for="choice-single-page">Single Page</label>

                                                    <div class="reveal-if-active">
                                                        <label for="which-page" style="color:white">Enter Page
                                                            Number</label>
                                                        <input type="text" id="which-page" name="which-page"
                                                            class="require-if-active"
                                                            data-require-pair="#choice-single-page">
                                                    </div>

                                                </div>
                                                <br>


                                                <div class="info">
                                                    <i class="fa fa-info-circle" style="font-size:15px;">
                                                        <p>
                                                        <h6>Select any one page from the file.</h6>
                                                        </p>
                                                    </i>
                                                </div>




                                            </div>
                                        </div>


                                    </div>
                                </div>
                            </div>

                        </div>

                        <!-- Insering a particular range of page numbers -->
                        <div class="col-xl-3 col-sm-6 col-12">
                            <div class="card" style="max-width: 18rem;">
                                <div class="card-content">

                                    <div class="card-body">
                                        <div class="media d-flex">
                                            <div class="align-self-center">


                                            </div>

                                            <div class="media-body text-left">
                                                <div>

                                                    <input type="radio" name="options" value='3' id="choice-range-page"
                                                        required>
                                                    <label for="choice-range-page">Custom Page Range</label>

                                                    <div class="reveal-if-active">
                                                        <label for="which-page" style="color:white">Enter Start Page
                                                            Number</label>
                                                        <input type="text" id="start-page" name="start-page"
                                                            class="require-if-active"
                                                            data-require-pair="#choice-range-page">
                                                    </div>
                                                    <div class="reveal-if-active">
                                                        <label for="which-page" style="color:white">Enter End Page
                                                            Number</label>
                                                        <input type="text" id="end-page" name="end-page"
                                                            class="require-if-active"
                                                            data-require-pair="#choice-range-page">
                                                    </div>

                                                </div>

                                                <br>
                                                <div class="info">
                                                    <i class="fa fa-info-circle" style="font-size:15px;">
                                                        <p>
                                                        <h6>Select start page and end page of the file.</h6>
                                                        </p>
                                                    </i>
                                                </div>


                                            </div>

                                        </div>

                                    </div>
                                </div>
                            </div>

                        </div>

                        <!-- Card for detecting all the pages in the pdf -->
                        <div class="col-xl-3 col-sm-6 col-12">
                            <div class="card" style="max-width: 18rem;">
                                <div class="card-content">

                                    <div class="card-body">
                                        <div class="media d-flex">
                                            <div class="align-self-center">


                                            </div>

                                            <div class="media-body text-left">
                                                <div>
                                                    <input type="radio" name="options" value='2'
                                                        id="choice-multiple-pages">
                                                    <label for="choice-multiple-pages">Detect All Pages</label>
                                                </div>


                                                <br>
                                                <div class="info">
                                                    <i class="fa fa-info-circle" style="font-size:15px;">
                                                        <p>
                                                        <h6>Process all the pages of the file at once</h6>
                                                        </p>
                                                    </i>
                                                </div>

                                            </div>

                                        </div>

                                    </div>
                                </div>
                            </div>

                        </div>

                    </div>


                    <br>
                    <br>

                    <!-- Submit button after selection of the options -->
                    <div id="content" style="margin-left:310px; ">

                        <input type="submit" value="Let's Scan" disabled style="cursor:not-allowed"
                            onclick=" return loading();" />

                    </div>





                </div>
            </div>

        </div>

    </form>


</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js'></script>
<script src="{{ url_for('static',filename='main.js') }}"></script>

<script>
    $(function () {
        $("#content-loading").load("/ajax/index");
    });
</script>


<script type="text/javascript">






    $('input:file').on("change", function () {

        const fi = document.getElementById('file');
        // Check if any file is selected.
        if (fi.files.length > 0) {
            for (const i = 0; i <= fi.files.length - 1; i++) {

                const fsize = fi.files.item(i).size;
                const file = Math.round((fsize / 1024));
                // The size of the file.
                if (file >= 256000) {

                    $("#pdf_count").hide();

                    document.getElementById('size').innerHTML = "File Size:" + '<b>'
                        + file + '</b> KB';
                    $('input:submit').prop('disabled', $(this).val()).css('cursor', 'not-allowed');
                    document.getElementById("size_val").innerHTML = "File too Big, please select a file less than 250mb!!";
                } else if (file < 1) {
                    $("#pdf_count").hide();

                    $("#size_val").show();
                    document.getElementById('size').innerHTML = "File Size:" + '<b>'
                        + file + '</b> KB';
                    $('input:submit').prop('disabled', $(this).val()).css('cursor', 'not-allowed');
                    document.getElementById("size_val").innerHTML = "File too small, please select a file greater than 50kb!!";
                } else {

                    $("#size_val").hide();
                    document.getElementById('size').innerHTML = "File Size:" + '<b>'
                        + file + '</b> KB';
                    $('input:submit').prop('disabled', !$(this).val()).css('cursor', 'pointer');
                    var input = document.getElementById("file");
                    var reader = new FileReader();
                    reader.readAsBinaryString(input.files[0]);
                    reader.onloadend = function () {
                        count1 = reader.result.match(/\/Type[\s]*\/Page[^s]/g).length;
                        // console.log('Number of Pages:',count );
                        document.getElementById("pdf_count").innerHTML = "Total pages: " + count1;
                        $("#pdf_count").show();
                    }
                }
            }

        }






    });


    function loading() {

        if (document.getElementById("choice-single-page").checked == true || document.getElementById("choice-range-page").checked == true || document.getElementById("choice-multiple-pages").checked == true) {
            if (document.getElementById("which-page").value.length == 0 && (document.getElementById("start-page").value.length == 0 || document.getElementById("end-page").value.length == 0) && document.getElementById("choice-multiple-pages").checked !== true) {
                $("#loading").hide();
                $("#content").show();
                $("#pagetype").hide();
                $('#pagetype1').css({ 'color': 'red' });
                $("#pagetype1").show();
            }

            else if (document.getElementById("choice-single-page").checked == true) {
                if (document.getElementById("which-page").value.length == 0) {
                    $("#loading").hide();
                    $("#content").show();
                    $("#pagetype").hide();
                    $('#pagetype1').css({ 'color': 'red' });
                    $("#pagetype1").show();
                }
                else if (document.getElementById("which-page").value > count1 || document.getElementById("which-page").value <= 0) {
                    $("#loading").hide();
                    $("#content").show();
                    $("#pagetype").hide();
                    $('#pagetype2').hide();
                    $('#pagetype1').hide();
                    $('#pagetype3').css({ 'color': 'red' });
                    $('#pagetype3').show();
                    return false;


                }
                else {
                    $("#loading").show();

                    $("#content").hide();
                    $("#pagetype").hide();
                    $("#pagetype1").hide();
                    $("#pagetype3").hide();
                }
            }

            else if (document.getElementById("choice-range-page").checked == true) {
                if (document.getElementById("start-page").value.length == 0 || document.getElementById("end-page").value.length == 0) {
                    $("#loading").hide();
                    $("#content").show();
                    $("#pagetype").hide();
                    $('#pagetype1').css({ 'color': 'red' });
                    $("#pagetype1").show();
                }
                else if ((document.getElementById("start-page").value > document.getElementById("end-page").value) && (document.getElementById("start-page").value > count1 || document.getElementById("start-page").value <= 0 || document.getElementById("end-page").value > count1 || document.getElementById("end-page").value <= 0)) {


                    $("#loading").hide();
                    $("#content").show();
                    $("#pagetype").hide();
                    $('#pagetype2').css({ 'color': 'red' });
                    $('#pagetype2').show();
                    $('#pagetype3').css({ 'color': 'red' });
                    $('#pagetype3').show();
                    return false;

                }
                else if (document.getElementById("start-page").value > document.getElementById("end-page").value) {


                    $("#loading").hide();
                    $("#content").show();
                    $("#pagetype").hide();
                    $('#pagetype2').css({ 'color': 'red' });
                    $('#pagetype2').show();
                    return false;

                }
                else if (document.getElementById("start-page").value > count1 || document.getElementById("start-page").value <= 0 || document.getElementById("end-page").value > count1 || document.getElementById("end-page").value <= 0) {
                    $("#loading").hide();
                    $("#content").show();
                    $("#pagetype").hide();
                    $('#pagetype2').hide();
                    $('#pagetype1').hide();
                    $('#pagetype3').css({ 'color': 'red' });
                    $('#pagetype3').show();
                    return false;
                }
                else {
                    $("#loading").show();
                    var loadTime = window.performance.timing.domContentLoadedEventEnd - window.performance.timing.navigationStart;
                    console.log(loadTime);
                    console.log(window.performance);
                    $("#content").hide();
                    $("#pagetype").hide();
                    $("#pagetype1").hide();
                    $("#pagetype2").hide();
                    $("#pagetype3").hide();
                }
            }






            else {
                $("#loading").show();


                $("#content").hide();
                $("#pagetype").hide();
                $("#pagetype1").hide();

            }
        } else {
            $("#loading").hide();
            $("#content").show();
            $('#pagetype').css({ 'color': 'red' });
            $("#pagetype").show();
        }



    }


</script>


{% endblock %}